# Repository Guidelines

## Project Structure & Module Organization
The entry point is `init.el`, which loads modular configuration from `lisp/` (each `init-*.el` file configures one feature). `site-lisp/` vendors third-party packages that are not installed through ELPA. Autogenerated state lives in directories such as `auto-save-list/`, `history/`, and `recentf.eld`, and should be left alone. Keep personal overrides in `lisp/init-local.el` or `custom.el`. Byte-compiled output in `eln-cache/` and package snapshots under `elpa-31.0/` are ephemeral and must not be edited or committed. Startup tuning in `early-init.el` should stay minimal and only adjust cross-platform defaults.

## Build, Test, and Development Commands
- `./test-startup.sh`: launches Emacs in batch mode with strict error checking to verify the configuration loads without regressions.
- `EMACS=/path/to/Emacs ./test-startup.sh`: repeat the startup check against a specific Emacs binary when validating cross-version support.
- `emacs -nw --batch -l init.el --eval '(message "OK")'`: quick smoke test while iterating on a single module; keep `user-emacs-directory` pointing at the repo to mirror CI.

## Coding Style & Naming Conventions
Prefer idiomatic Emacs Lisp with lexical binding (`lexical-binding: t` at the file top). Let `emacs-lisp-mode` manage indentation; default is two spaces and avoid lines wider than 100 columns. Group related helpers into small functions and keep heavy logic inside dedicated `init-*.el` modules. Name new modules `init-<feature>.el`, functions `init-<feature>-...`, and user options under the `sanityinc/` prefix to avoid collisions. Run `M-x checkdoc` and `M-x package-lint-current-buffer` when introducing new public APIs.

## Testing Guidelines
Run `./test-startup.sh` before every commit; it exercises the same hooks as CI and catches missing `require` statements early. When adding a package, confirm it loads with `emacs -Q` plus `load-file` to ensure no implicit dependencies leak in. Prefer feature flags and `maybe-require-package` to degrade gracefully on older Emacs versions. Document manual test steps in the PR description, especially for interactive changes.

## Commit & Pull Request Guidelines
Adopt Conventional Commit prefixes (`feat:`, `fix:`, `chore:`, `docs:`) as seen in recent history. Keep commits focused: one module or behaviour change per commit, accompanied by rationale in the message body. Pull requests should include a concise summary, mention the commands you ran (`./test-startup.sh`, manual sessions), and link any tracked issues. Screenshots or short demos are welcome when UI behaviour changes. Do not bundle personal config tweaks; keep the repo clean and reproducible.

## Configuration & Safety Notes
Never commit machine-specific artifacts (`transient/`, `undo-fu-session/`, cache files). If you add new optional tooling, gate it with `maybe-require-package` and guard macOS-specific code with `*is-a-mac*`. When touching startup performance, measure with `M-x profiler-start` or the existing benchmarking hooks before merging. Respect the "never break userspace" rule: changes must preserve a clean startup for existing users without forcing resets of their local `custom.el`.
